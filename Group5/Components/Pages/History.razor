@page "/history"
@inject NavigationManager Navigation
@rendermode InteractiveServer

<div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="profile-section">
            <h3>Hello, User!!</h3>
            <div class="profile-pic">
                <div class="user-icon">ðŸ‘¤</div>
            </div>
            <button class="logout-btn">Log Out</button>
        </div>

        <nav class="nav-menu">
            <a href="/dashboard" class="nav-item">> Dashboard</a>
            <a href="/borrow" class="nav-item">> Borrow</a>
            <a href="/cart" class="nav-item">> Cart</a>
            <a href="/history" class="nav-item active">> History</a>
        </nav>

        <div class="footer-links">
            <a href="#">User Profile</a>
            <a href="#">Need help?</a>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <header class="top-header">
            <h1><span class="icon">ðŸ“‹</span> HISTORY</h1>
            <span class="email">pogiako@ue.edu.ph</span>
        </header>

        <hr class="divider" />

        <div class="search-controls">
            <div class="search-row">
                <select @bind="searchCriteria">
                    <option value="Department">Department</option>
                    <option value="Professor">Professor</option>
                    <option value="StudentName">Student Name</option>
                    <option value="StudentNumber">Student Number</option>
                    <option value="ItemBorrowed">Item Borrowed</option>
                    <option value="Status">Status</option>
                </select>
                <input type="text" @bind="searchTerm" placeholder="Enter search term" />
                <input type="date" @bind="searchDate" placeholder="Search by Date" />
                <button @onclick="SearchTransactions" class="search-btn">Search</button>
                <button @onclick="ClearSearch" class="clear-btn">Clear</button>
            </div>
        </div>

        @if (transactions != null && transactions.Any())
        {
            <div class="table-container">
                <table class="transaction-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Department</th>
                            <th>Professor</th>
                            <th>Student Name</th>
                            <th>Student Number</th>
                            <th>Item Borrowed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var transaction in filteredTransactions)
                        {
                            <tr>
                                <td>@transaction.Date.ToShortDateString()</td>
                                <td>@transaction.Department</td>
                                <td>@transaction.Professor</td>
                                <td>@transaction.StudentName</td>
                                <td>@transaction.StudentNumber</td>
                                <td>@transaction.ItemBorrowed</td>
                                <td>
                                    <span class="status-badge @transaction.Status.ToLower()">@transaction.Status</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="no-data">
                <p>No transactions found.</p>
            </div>
        }
    </main>
</div>

@code {
    private string searchCriteria = "Department";
    private string searchTerm = string.Empty;
    private DateTime? searchDate;
    private List<Transaction> transactions = new();
    private List<Transaction> filteredTransactions => FilterTransactions();

    protected override void OnInitialized()
    {
        LoadSampleData();
    }

    private void LoadSampleData()
    {
        transactions = new List<Transaction>
        {
            new Transaction { Date = DateTime.Today, Department = "Computer Engineering", Professor = "Marjon Umbay", StudentName = "Jevric Tampus", StudentNumber = "20246627908", ItemBorrowed = "BreadBoard", Status = "Borrowed" },
            new Transaction { Date = DateTime.Today.AddDays(-1), Department = "Electronics Engineering", Professor = "June Valencia", StudentName = "Chang Park", StudentNumber = "20246627909", ItemBorrowed = "DC Power Supply", Status = "Returned" },
            new Transaction { Date = DateTime.Today.AddDays(-2), Department = "Computer Engineering", Professor = "Marjon Umbay", StudentName = "Alexa Cruz", StudentNumber = "20241234567", ItemBorrowed = "Multimeter", Status = "Borrowed" },
            new Transaction { Date = DateTime.Today, Department = "Civil Engineering", Professor = "Mark Santos", StudentName = "Raquim Joven", StudentNumber = "20235554444", ItemBorrowed = "Meter Stick", Status = "Borrowed" },
        };
    }

    private List<Transaction> FilterTransactions()
    {
        var query = transactions.AsEnumerable();

        if (searchDate.HasValue)
            query = query.Where(t => t.Date.Date == searchDate.Value.Date);

        if (!string.IsNullOrWhiteSpace(searchTerm))
        {
            query = query.Where(t =>
            {
                string value = searchCriteria switch
                {
                    "Department" => t.Department,
                    "Professor" => t.Professor,
                    "StudentName" => t.StudentName,
                    "StudentNumber" => t.StudentNumber,
                    "ItemBorrowed" => t.ItemBorrowed,
                    "Status" => t.Status,
                    _ => string.Empty
                };
                return value.Contains(searchTerm, StringComparison.OrdinalIgnoreCase);
            });
        }

        return query.ToList();
    }

    private void SearchTransactions() => StateHasChanged();

    private void ClearSearch()
    {
        searchCriteria = "Department";
        searchTerm = string.Empty;
        searchDate = null;
        StateHasChanged();
    }

    public class Transaction
    {
        public DateTime Date { get; set; }
        public string Department { get; set; } = string.Empty;
        public string Professor { get; set; } = string.Empty;
        public string StudentName { get; set; } = string.Empty;
        public string StudentNumber { get; set; } = string.Empty;
        public string ItemBorrowed { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
    }
}

<style>
/* Reuse identical styling from Borrow.razor for a unified design */
.layout { display: flex; min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; }
.sidebar { width: 280px; background: linear-gradient(to bottom, #a00000, #7a0000); color: white; display: flex; flex-direction: column; justify-content: space-between; padding: 25px 20px; box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1); }
.profile-section { text-align: center; margin-bottom: 35px; }
.profile-section h3 { margin: 0 0 18px 0; font-size: 1.3rem; font-weight: bold; }
.profile-pic { width: 100px; height: 100px; background-color: white; border-radius: 50%; margin: 0 auto 18px; display: flex; align-items: center; justify-content: center; border: 3px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
.user-icon { font-size: 2.5rem; color: #333; }
.logout-btn { background: white; color: #333; border: none; border-radius: 8px; padding: 12px 24px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
.logout-btn:hover { background: #f0f0f0; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
.nav-menu { flex: 1; display: flex; flex-direction: column; gap: 6px; margin: 18px 0; }
.nav-item { display: block; background: transparent; color: white; padding: 16px 18px; border-radius: 8px; font-weight: bold; font-size: 1.1rem; text-decoration: none; transition: all 0.3s ease; border-left: 3px solid transparent; }
.nav-item:hover { background-color: rgba(255, 255, 255, 0.1); border-left-color: rgba(255, 255, 255, 0.5); transform: translateX(5px); }
.nav-item.active { background-color: rgba(255, 255, 255, 0.15); border-left-color: white; box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1); }
.footer-links { display: flex; flex-direction: column; align-items: center; gap: 10px; text-align: center; margin-top: 18px; padding-top: 18px; border-top: 1px solid rgba(255, 255, 255, 0.2); }
.footer-links a { color: white; font-size: 1rem; text-decoration: underline; transition: opacity 0.3s ease; }
.footer-links a:hover { opacity: 0.8; }

/* === Main Content === */
.main-content { flex: 1; padding: 30px 40px; background-color: #fff; overflow-y: auto; }
.top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.top-header h1 { font-size: 2.2rem; font-weight: bold; display: flex; align-items: center; gap: 12px; margin: 0; color: #333; }
.top-header .icon { font-size: 1.8rem; }
.email { color: #666; font-weight: 600; font-size: 1rem; }
.divider { border: none; height: 3px; background: linear-gradient(to right, #a00000, #c00000); margin: 0 0 30px 0; border-radius: 2px; }

/* === Search Section & Table (styled to match Borrow theme) === */
.search-controls { background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #dee2e6; }
.search-row { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
.search-row input, .search-row select { flex-grow: 1; min-width: 180px; padding: 12px 16px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; }
.search-row input:focus, .search-row select:focus { outline: none; border-color: #a00000; box-shadow: 0 0 0 3px rgba(160,0,0,0.1); }
.search-btn, .clear-btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; min-width: 100px; }
.search-btn { background: linear-gradient(135deg,#a00000,#c00000); color:white; }
.search-btn:hover { background: linear-gradient(135deg,#b00000,#d00000); transform: translateY(-2px); }
.clear-btn { background: #6c757d; color: white; }
.clear-btn:hover { background: #5a6268; transform: translateY(-2px); }

.table-container { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #dee2e6; overflow: hidden; }
.transaction-table { width: 100%; border-collapse: collapse; }
.transaction-table th { background: linear-gradient(135deg,#a00000,#c00000); color: white; padding: 16px 12px; text-align: left; font-weight: bold; }
.transaction-table td { padding: 14px 12px; border-bottom: 1px solid #dee2e6; font-size: 0.95rem; color: #333; }
.transaction-table tr:nth-child(even) { background-color: #f8f9fa; }
.transaction-table tr:hover { background-color: #e9ecef; transition: 0.2s; }

.status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; text-transform: uppercase; }
.status-badge.borrowed { background-color: #ffc107; color: #212529; }
.status-badge.returned { background-color: #28a745; color: white; }

.no-data { text-align: center; padding: 60px 20px; color: #6c757d; font-size: 1.1rem; }


}
</style>
